{"version":3,"file":"srt.js","sources":["../../node_modules/.@babel/runtime@7.1.2/helpers/classCallCheck.js","../../node_modules/.@babel/runtime@7.1.2/helpers/createClass.js","../../src/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","class SrtJs {\n  constructor(option) {\n    this.option = Object.assign({}, SrtJs.DEFAULTS, option);\n    this.init();\n  }\n\n  static get version() {\n    return '__VERSION__';\n  }\n\n  static get DEFAULTS() {\n    return {\n      videoElement: '',\n      subtitles: []\n    };\n  }\n\n  static polyfill() {\n    Object.getOwnPropertyNames(this.prototype).forEach(method => {\n      if (method !== 'constructor') {\n        this[method] = this.prototype[method].bind(this);\n      }\n    });\n\n    this.$videos = Array.from(document.querySelectorAll('video'));\n    this.$videos.forEach($video => {\n      this.changeTrack($video);\n    });\n  }\n\n  init() {\n    this.$video = this.getElement(this.option.videoElement);\n    this.option.subtitles.forEach(subtitle => {\n      this.creatTrack(subtitle);\n    });\n  }\n\n  getElement(query) {\n    return query instanceof Element ? query : document.querySelector(query);\n  }\n\n  changeTrack($video) {\n    const $tracks = Array.from($video.querySelectorAll('track'));\n    $tracks.forEach($track => {\n      this.fetchUrl($track.src).then(data => {\n        if ($track.src !== data) {\n          $track.src = data;\n        }\n      });\n    });\n  }\n\n  creatTrack(subtitle) {\n    const $track = document.createElement('track');\n    $track.label = subtitle.label || '';\n    $track.kind = subtitle.kind || '';\n    $track.srclang = subtitle.srclang || '';\n    $track.default = subtitle.default || false;\n    this.fetchUrl(subtitle.src).then(data => {\n      $track.src = data;\n      this.$video.appendChild($track);\n    });\n  }\n\n  fetchUrl(url) {\n    let type;\n    return fetch(url)\n      .then(response => {\n        type = response.headers.get('Content-Type');\n        return response.text();\n      })\n      .then(text => {\n        if ((/x-subrip/ig).test(type)) {\n          return this.srtToVtt(text);\n        }\n        return Promise.resolve(url);\n      })\n      .catch(err => {\n        throw err;\n      });\n  }\n\n  srtToVtt(text) {\n    const vttText = 'WEBVTT \\r\\n\\r\\n'.concat(text\n      .replace(/\\{\\\\([ibu])\\}/g, '</$1>')\n      .replace(/\\{\\\\([ibu])1\\}/g, '<$1>')\n      .replace(/\\{([ibu])\\}/g, '<$1>')\n      .replace(/\\{\\/([ibu])\\}/g, '</$1>')\n      .replace(/(\\d\\d:\\d\\d:\\d\\d),(\\d\\d\\d)/g, '$1.$2')\n      .concat('\\r\\n\\r\\n'));\n    return this.toBlob(vttText);\n  }\n\n  toBlob(text) {\n    return URL.createObjectURL(new Blob([text], {\n      type: 'text/vtt'\n    }));\n  }\n}\n\nwindow.SrtJs = SrtJs;\nexport default SrtJs;\n"],"names":["SrtJs","option","Object","assign","DEFAULTS","init","$video","getElement","videoElement","subtitles","forEach","subtitle","creatTrack","query","Element","document","querySelector","$tracks","Array","from","querySelectorAll","$track","fetchUrl","src","then","data","createElement","label","kind","srclang","default","appendChild","url","type","fetch","response","headers","get","text","test","srtToVtt","Promise","resolve","catch","err","vttText","concat","replace","toBlob","URL","createObjectURL","Blob","getOwnPropertyNames","prototype","method","bind","$videos","changeTrack","window"],"mappings":"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"}