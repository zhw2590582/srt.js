!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.srt=t()}(this,function(){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var e=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e},t=function(){function t(e){n(this,t),this.option=Object.assign({},t.DEFAULTS,e),this.init()}return e(t,[{key:"init",value:function(){var t=this;this.$video=this.getElement(this.option.videoElement),this.option.subtitles.forEach(function(e){t.creatTrack(e)})}},{key:"getElement",value:function(e){return e instanceof Element?e:document.querySelector(e)}},{key:"changeTrack",value:function(e){var n=this;Array.from(e.querySelectorAll("track")).forEach(function(t){n.fetchUrl(t.src).then(function(e){t.src!==e&&(t.src=e)})})}},{key:"creatTrack",value:function(e){var t=this,n=document.createElement("track");n.label=e.label||"",n.kind=e.kind||"",n.srclang=e.srclang||"",n.default=e.default||!1,this.fetchUrl(e.src).then(function(e){n.src=e,t.$video.appendChild(n)})}},{key:"fetchUrl",value:function(t){var n,r=this;return fetch(t).then(function(e){return n=e.headers.get("Content-Type"),e.text()}).then(function(e){return/x-subrip/gi.test(n)?r.srtToVtt(e):Promise.resolve(t)}).catch(function(e){throw e})}},{key:"srtToVtt",value:function(e){var t="WEBVTT \r\n\r\n".concat(e.replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").concat("\r\n\r\n"));return this.toBlob(t)}},{key:"toBlob",value:function(e){return URL.createObjectURL(new Blob([e],{type:"text/vtt"}))}}],[{key:"polyfill",value:function(){var t=this;Object.getOwnPropertyNames(this.prototype).forEach(function(e){"constructor"!==e&&(t[e]=t.prototype[e].bind(t))}),this.$videos=Array.from(document.querySelectorAll("video")),this.$videos.forEach(function(e){t.changeTrack(e)})}},{key:"version",get:function(){return"1.0.0"}},{key:"DEFAULTS",get:function(){return{videoElement:"",subtitles:[]}}}]),t}();return window.SrtJs=t});
